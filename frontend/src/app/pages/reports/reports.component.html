<section class="page">
  <div class="page-header">
    <h1>Reporte – Estado de cuenta</h1>
  </div>

  <div class="table-wrap" style="padding: 18px;">
    <div class="form-grid">
      <label class="field">
        <span>Cliente</span>
        <select [(ngModel)]="clientId">
          <option value="" disabled>Seleccione</option>
          <option *ngFor="let c of clients" [value]="c.id">
            {{ c.name }} ({{ c.identification }})
          </option>
        </select>
      </label>

      <label class="field">
        <span>Desde</span>
        <input type="datetime-local" [(ngModel)]="from" />
      </label>

      <label class="field">
        <span>Hasta</span>
        <input type="datetime-local" [(ngModel)]="to" />
      </label>
    </div>

    <div class="form-actions">
      <button class="btn btn-primary" (click)="generate()" [disabled]="isLoading">
        Buscar
      </button>
    </div>
  </div>

  <div class="info-row" *ngIf="errorMessage">
    <div class="alert alert-error">{{ errorMessage }}</div>
  </div>

  <div *ngIf="report">
    <h2>{{ report.clientName }} – {{ report.identification }}</h2>

    <div *ngFor="let acc of report.accounts" class="table-wrap" style="margin-top:16px">
      <table class="table">
        <thead>
          <tr>
            <th>Cuenta</th>
            <th>Tipo</th>
            <th>Saldo Inicial</th>
            <th>Créditos</th>
            <th>Débitos</th>
            <th>Saldo Final</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>{{ acc.accountNumber }}</td>
            <td>{{ acc.accountType }}</td>
            <td>{{ acc.initialBalance }}</td>
            <td>{{ acc.totalCredits }}</td>
            <td>{{ acc.totalDebits }}</td>
            <td>{{ acc.finalBalance }}</td>
          </tr>
        </tbody>
      </table>

      <table class="table" style="margin-top:10px">
        <thead>
          <tr>
            <th>Fecha</th>
            <th>Tipo</th>
            <th>Valor</th>
            <th>Saldo</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let m of acc.movements">
            <td>{{ m.movementDate | date:'yyyy-MM-dd HH:mm' }}</td>
            <td>
              <span class="pill" [class.pill-on]="m.movementType === 'DEPOSIT'"
                                [class.pill-off]="m.movementType !== 'DEPOSIT'">
                {{ m.movementType }}
              </span>
            </td>
            <td>{{ m.value }}</td>
            <td>{{ m.balance }}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="form-actions" style="margin-top:20px">
      <button class="btn btn-primary" (click)="downloadPdf()">
        Descargar PDF
      </button>
    </div>
  </div>
</section>